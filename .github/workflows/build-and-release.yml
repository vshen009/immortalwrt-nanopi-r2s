name: Build and Release ImmortalWrt for NanoPi R2S eMMC

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Clean old logs
      run: rm -rf /home/runner/actions-runner/cached/_diag/*

    - name: Clean ccache
      run: rm -rf ~/.ccache

    - name: Install build dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-pip python3-dev python3-setuptools swig build-essential libncurses5-dev flex bison git-core ccache g++ unzip wget
        # 全局安装 pyelftools，解决 u-boot 检测失败问题
        sudo pip3 install pyelftools

    - name: Clon
